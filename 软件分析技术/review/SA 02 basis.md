程序设计语言的两大要素：

**语法** $\text{Syntax}$ ：程序的静态书写方式
**语义** $\text{Semantics}$ ：程序的动态执行方式

#### 文法和自动机
[[第20章 语言和文法|语言和文法]]

一个文法包括：
- 一组非终结符，用大写字母表示，如 $S, A, B$
- 一组终结符，用小写字母表示，如 $a, b$
- 一个非终结符作为开始符号，用字母 $S$ 表示
- 一组推导规则，表示把一个字符串中的左边部分替换成右边部分

所有从 $S$ 开始，应用**任意多次**推导规则可以生成的所有**终结符序列**构成了**文法对应语言**，即一个编程语言的语法所允许的所有程序

**自动机**：根据输入序列改变内部状态的机器
![[0299a452-bf36-4a99-a552-281ba41c04eb.png]]
正则文法：形如 $A\to a$ 或者 $A\to aB$ 或者 $S\to \epsilon$ 
	和正则表达式可以互相转换
上下文无关文法：形如 $A\to \gamma$
上下文有关文法：形如 $\alpha A\beta\to\alpha\gamma\beta$

现代程序设计语言通常采用正则文法描述程序基本单元，称为token（对应词法分析）
- `Number := 0|[1-9][0-9]*`
- `Iden := [a-zA-Z_][0-9a-zA-Z_]*`
再将token作为终结符，采用上下文无关文法描述整 个语言（对应语法分析）
- `Expr -> Expr + Expr | Expr – Expr | Number | Iden`

分成这两部分的原因是：
- 简化设计：可以在token序列上做过滤去掉空白符和注释
- 提高效率：正则文法的解析更快，另外还可以针对词法分析设计专门缓存技术
- 可移植性：只有词法分析和机器的字符表示有关

#### 描述语义

操作语义：将程序元素解释为计算步骤
指称语义：将程序元素解释为数学中严格定义的对象，通常为函数
	二者通常是等价的，只是惯用的符号不同，操作语义常采用逻辑推导规则描述，指称语义常采用集合定义描述
公理语义：将程序元素解释为前条件和后条件，并可用霍尔逻辑推导

#### 编译与程序分析

在保证语义不变的情况下，将程序从一种语法变换到另一种语法的技术
	通常是高级语言的程序变换到低级语言

程序分析和编译都依赖程序**语法的解析**

编译器依赖程序分析**检查和推导类型**、查找常见错误和保证优化的安全性

##### 一次典型的编译过程：
![[4ea2bdb7-b09f-4fdf-bf63-e0b63a2b0233.png]]

**中间代码：**
- 独立于机器
- 通常易于分析
- 易于翻译成汇编代 码
- 不同编译器的中间 代码差别很大，没有通用标准

**机器无关优化：**
- 常量传播
- 冗余消除
- 展开函数调用
- 将`if`替换成条件移动
- 部分高级语言相关优化也可以放到抽象语法树上进行

**目标代码生成**：
将中间代码转换成目标机器的代码

**机器相关优化**：
- 利用指令级并行的优化
- 利用SSE指令的优化

机器相关优化在编译时无法完全实施
- 不能预先知道对方机器的类型
- CPU dispatching


编译器：一次把源程序翻译成机器代码
解释器：每次读取一条语句
JIT编译虚拟机：每次加载一个模块，或者运行 一个函数之前一次性编译
	对于Python、Javascript等动态语言，JIT是唯一优化动态产生代码的方式
	JIT编译虚拟机的运行速度有时能比编译快10倍以上！


#### 程序的表示

[《静态分析/软件分析学习笔记》2.中间表示(Intermediate Representation) - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/549728632)

**具体语法树**是一棵树：叶子节点标记为终结符，非叶子节点标记为非终结符，根是开始符号。每个非叶子节点$N$和其子节点对应一条上下文无关文 法推导规则，从$N$对应的非终结符产生其子节点对应的符号序列

**抽象语法树** AST：具体语法树中有很多我们后期不再关心的符号，将这些符号删掉，形成抽象语法树

**三地址码**：一种最常用的中间代码，编译器可以通过它来**改进代码效率**。每个三地址码都可以分解为一个**四元组**（操作数1，操作数2，结果，操作符）的形式

**控制流图** 
控制流——语句执行的顺序 
控制流图——表示语句执行顺序的图 
控制流图的节点 
	基本块：依次顺序执行的语句序列，只有最后一条语句可以分支/跳转 
控制流图的边 
	基本块之间的可能转移关系

**语法制导翻译** 
在AST上的分析常用语法制导翻译表示 
	又叫归纳定义的函数


考虑简单语言IMP 
```imp
c := skip
  | x := e
  | c ; c
  | if e then c else c end
  | while e do c end
```
该语言的控制流图翻译见 [[SA HW 03 IMP ControlFlow]]
